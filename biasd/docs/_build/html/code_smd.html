

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SMD &mdash; BIASD v0.1.1</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="BIASD v0.1.1" href="index.html"/>
        <link rel="prev" title="MCMC" href="code_mcmc.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> BIASD</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#software-requirements">Software Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#adding-biasd-to-the-python-path">Adding BIASD to the Python Path</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="compileguide.html">Compiling the Likelihood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="compileguide.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="compileguide.html#how-to-compile">How to Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="compileguide.html#testing-speed">Testing Speed</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">BIASD Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#creating-a-new-smd-file">Creating a new SMD file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#sample-the-posterior-with-mcmc">Sample the posterior with MCMC</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#laplace-approximation-and-computing-the-predictive-posterior">Laplace approximation and computing the predictive posterior</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">BIASD GUI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gui.html#functionality">Functionality</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code_distributions.html">Distributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code_distributions.html#module-distributions">Some standard probability distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_distributions.html#convert-between-distributions">Convert between distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_distributions.html#distributions-can-be-collected-for-priors-or-posteriors">Distributions can be collected for priors or posteriors</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_distributions.html#collections-can-be-visualized">Collections can be visualized</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_distributions.html#module-distributions">Finally, you can easily generate a few useful collections using</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_laplace.html">Laplace</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code_laplace.html#laplace-approximation">Laplace Approximation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_likelihood.html">Likelihood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code_likelihood.html#switch-the-log-likelihood-function">Switch the log-likelihood function</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_likelihood.html#module-likelihood">Inference-related functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code_mcmc.html">MCMC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code_mcmc.html#markov-chain-monte-carlo">Markov chain Monte Carlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_mcmc.html#module-mcmc">Setup and Run MCMC</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_mcmc.html#module-mcmc">Analyze MCMC samples</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SMD</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#work-with-smd-data">Work with SMD data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-smd.add">Add BIASD results to an SMD object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-smd.read">Read BIASD results from an SMD object into a useful format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">BIASD</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>SMD</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/code_smd.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="smd">
<span id="code-smd"></span><h1>SMD<a class="headerlink" href="#smd" title="Permalink to this headline">¶</a></h1>
<p>This page gives the details about the code in biasd.io.</p>
<p>The Single-Molecule Dataset (SMD) format is a standardized data format for use in time-resolved, single-molecule experiments (e.g, smFRET, force spectroscopy, etc.). It was published in collaboration between the <a class="reference external" href="http://www.columbia.edu/cu/chemistry/groups/gonzalez/index.html">Gonzalez</a> and <a class="reference external" href="http://cmgm.stanford.edu/herschlag/">Herschlag</a> labs (Greenfield, M <em>et al</em>. <em>BMC Bioinformatics</em> <strong>2015</strong>, <em>16</em>, 3. <a class="reference external" href="http://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-014-0429-4">DOI: 10.1186/s12859-014-0429-4</a>). Here we have adapted the SMD data format for use with the <a class="reference external" href="https://support.hdfgroup.org/HDF5/">HDF5</a> data format, which we access with the python library <a class="reference external" href="http://www.h5py.org">h5py</a>.</p>
<div class="section" id="work-with-smd-data">
<h2>Work with SMD data<a class="headerlink" href="#work-with-smd-data" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-smd"></span><p>This module allows you to use the single-molecule dataset (SMD) format, and integrate BIASD results into them. The data is stored in as HDF5, and as such can be arbitrarily changed to fit your needs. Generally speaking, the structure is</p>
<blockquote>
<div><dl class="docutils">
<dt>SMD File <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">File)</span></code>:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>attrs <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Attributes)</span></code></dt>
<dd><ul class="first last simple">
<li>time created <code class="docutils literal"><span class="pre">(Str)</span></code></li>
<li>SMD hash ID <code class="docutils literal"><span class="pre">(Str)</span></code></li>
<li>number of trajectories <code class="docutils literal"><span class="pre">(Int)</span></code></li>
<li>attribute 1 (denotes generic attribute) <code class="docutils literal"><span class="pre">(Anything)</span></code></li>
<li>attribute 2 (denotes generic attribute) <code class="docutils literal"><span class="pre">(Anything)</span></code></li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>trajectory 0 <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Group)</span></code></dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>attrs <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Attributes)</span></code></dt>
<dd><ul class="first last simple">
<li>time created</li>
<li>SMD hash ID</li>
<li>attribute 1</li>
<li>attribute 2</li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>data <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Group)</span></code></dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>time <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Dataset)</span></code></dt>
<dd><ul class="first last simple">
<li>value <code class="docutils literal"><span class="pre">(numpy</span> <span class="pre">ndarray</span> <span class="pre">of</span> <span class="pre">values)</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>signal 1 <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Dataset)</span></code></dt>
<dd><ul class="first last simple">
<li>value <code class="docutils literal"><span class="pre">(numpy</span> <span class="pre">ndarray</span> <span class="pre">of</span> <span class="pre">values)</span></code></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">...</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>BIASD analysis 1 <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Group),</span> <span class="pre">eg</span> <span class="pre">ensemble</span> <span class="pre">MCMC</span> <span class="pre">results</span></code></dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>attrs <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Attributes)</span></code></dt>
<dd><ul class="first last simple">
<li>time created</li>
<li>SMD hash ID</li>
<li>attribute 1</li>
<li>attribute 2</li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>analysis dataset 1 <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Dataset),</span> <span class="pre">eg</span> <span class="pre">MCMC</span> <span class="pre">samples</span></code></dt>
<dd><ul class="first last simple">
<li>...</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>trajectory 1 <code class="docutils literal"><span class="pre">(HDF5</span> <span class="pre">Dataset)</span></code></dt>
<dd><ul class="first last simple">
<li>...</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="function">
<dt id="smd.new">
<code class="descclassname">smd.</code><code class="descname">new</code><span class="sig-paren">(</span><em>filename</em>, <em>force=False</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and close a new HDF5 file.
Input:</p>
<blockquote>
<div><ul class="simple">
<li><cite>filename</cite> is the output filename to save.</li>
<li><cite>force</cite> is a boolean whether to overwrite if the file already exists.</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd><ul class="first last simple">
<li><cite>f</cite> is the output h5py <cite>File</cite>.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="smd.load">
<code class="descclassname">smd.</code><code class="descname">load</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Open an HDF5 file in R/W mode with h5py
Input:</p>
<blockquote>
<div><ul class="simple">
<li><cite>filename</cite> is the input filename to open</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd><ul class="first last simple">
<li>an h5py file</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="smd.loadtxt">
<code class="descclassname">smd.</code><code class="descname">loadtxt</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.loadtxt" title="Permalink to this definition">¶</a></dt>
<dd><p>Safely load binary (.npy), tab, or comma delimited arrays
Input:</p>
<blockquote>
<div><ul class="simple">
<li><cite>filename</cite> is the file to open</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>Returns:</dt>
<dd><ul class="first last simple">
<li>a numpy <cite>ndarray</cite></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-smd.add">
<span id="add-biasd-results-to-an-smd-object"></span><h2>Add BIASD results to an SMD object<a class="headerlink" href="#module-smd.add" title="Permalink to this headline">¶</a></h2>
<p>Add a BIASD result to an HDF5 SMD file. This includes functions for <cite>prior collections</cite>, <cite>posterior collections</cite>, <cite>Laplace posteriors</cite>, <cite>baseline corrections</cite>, and <cite>MCMC results</cite>.</p>
<dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li><cite>parent</cite> is group of the HDF5 object where the analysis data will be added as a new group</li>
<li><cite>the next argument</cite> is the data object that will be added</li>
<li><cite>label</cite> is a string that the new group will be called. Defaults to descriptive label.</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="smd.add.baseline">
<code class="descclassname">smd.add.</code><code class="descname">baseline</code><span class="sig-paren">(</span><em>parent</em>, <em>params</em>, <em>label='result'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.baseline" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <cite>_params</cite> result from <cite>biasd.utils.baseline</cite> to HDF5 group</p>
</dd></dl>

<dl class="function">
<dt id="smd.add.kmeans">
<code class="descclassname">smd.add.</code><code class="descname">kmeans</code><span class="sig-paren">(</span><em>parent</em>, <em>kmeans_result</em>, <em>label='result'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.kmeans" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <cite>_results_kmeans</cite> from <cite>biasd.distributions</cite> to a HDF5 Group</p>
</dd></dl>

<dl class="function">
<dt id="smd.add.laplace_posterior">
<code class="descclassname">smd.add.</code><code class="descname">laplace_posterior</code><span class="sig-paren">(</span><em>parent</em>, <em>laplace_posterior</em>, <em>label='result'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.laplace_posterior" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <cite>_laplace_posterior</cite> from <cite>biasd.laplace</cite> to HDF5 group</p>
</dd></dl>

<dl class="function">
<dt id="smd.add.mcmc">
<code class="descclassname">smd.add.</code><code class="descname">mcmc</code><span class="sig-paren">(</span><em>parent</em>, <em>mcmc_result</em>, <em>label='result'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.mcmc" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <cite>mcmc_result</cite> from <cite>biasd.mcmc</cite> to a HDF5 group</p>
</dd></dl>

<dl class="function">
<dt id="smd.add.parameter_collection">
<code class="descclassname">smd.add.</code><code class="descname">parameter_collection</code><span class="sig-paren">(</span><em>parent</em>, <em>collection</em>, <em>label='BIASD parameter collection'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.parameter_collection" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <cite>parameter_collection</cite> from <cite>biasd.distributions</cite> to HDF5 group</p>
</dd></dl>

<dl class="function">
<dt id="smd.add.trajectories">
<code class="descclassname">smd.add.</code><code class="descname">trajectories</code><span class="sig-paren">(</span><em>f</em>, <em>x</em>, <em>y</em>, <em>x_label='Time'</em>, <em>y_label='Signal'</em><span class="sig-paren">)</span><a class="headerlink" href="#smd.add.trajectories" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple add for homogeneous-length signal versus time trajectories to an HDF5 file for use in BIASD.
Input:</p>
<blockquote>
<div><ul class="simple">
<li><cite>f</cite> is for an already open h5py <cite>File</cite> &#8211; create one with smd.new(filename), and open it with smd.open(filename)</li>
<li><cite>x</cite> is a (T) numpy <cite>ndarray</cite></li>
<li><cite>y</cite> is a (N,T) numpy <cite>ndarray</cite></li>
</ul>
</div></blockquote>
<p>where <cite>N</cite> is the number of molecules, and <cite>T</cite> is the number of datapoints</p>
<p>Trajectories are added as groups called `trajectory i`, where <cite>i</cite> is an integer. Also, adds the number of trajectories in the file as an attribute to the <cite>File</cite>. This can be accessed as <cite>f.attrs[&#8216;number of trajectories]</cite>. Also, adds the number of datapoints in these trajectories as <cite>f.attrs[&#8216;number of datapoints]</cite>.</p>
</dd></dl>

</div>
<div class="section" id="module-smd.read">
<span id="read-biasd-results-from-an-smd-object-into-a-useful-format"></span><h2>Read BIASD results from an SMD object into a useful format<a class="headerlink" href="#module-smd.read" title="Permalink to this headline">¶</a></h2>
<p>Reads a BIASD result from an HDF5 SMD file. This includes functions for <cite>parameter collections</cite>, <cite>Laplace posteriors</cite>, <cite>baseline corrections</cite>, and <cite>MCMC results</cite>.</p>
<dl class="docutils">
<dt>Input:</dt>
<dd><ul class="first last simple">
<li><cite>group</cite> is the input HDF5 group from where the data will be read</li>
</ul>
</dd>
<dt>Returns:</dt>
<dd><ul class="first last simple">
<li>The data formatted as an object</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Create, add, and save example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">biasd</span> <span class="kn">as</span> <span class="nn">b</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># Load the data</span>
<span class="n">cy3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;my_cy3_data.dat&#39;</span><span class="p">)</span>
<span class="n">cy5</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;my_cy5_data.dat&#39;</span><span class="p">)</span>
<span class="n">fret</span> <span class="o">=</span> <span class="n">d1</span><span class="o">/</span><span class="p">(</span><span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="p">)</span>

<span class="c"># Create the time axis, assuming data is in (N,T) array</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fret</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">tau</span>


<span class="c"># Make a new HDF5 SMD file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;20161230_fret_experiment_1.hdf5&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c"># Add the FRET trajectories</span>
<span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">trajectories</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">fret</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="s">&#39;Time (s)&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s">&#39;E_{FRET}&#39;</span><span class="p">)</span>
<span class="n">nmolecules</span>  <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;number of trajectories&#39;</span><span class="p">]</span>

<span class="c"># Save and close the output file</span>
<span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c"># Setup the priors</span>
<span class="n">e1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">9.</span><span class="p">)</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">9.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="mf">2.</span><span class="o">/.</span><span class="mo">05</span><span class="p">)</span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">20.</span><span class="p">,</span><span class="mf">20.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">20.</span><span class="p">,</span><span class="mf">20.</span><span class="o">/</span><span class="mf">8.</span><span class="p">)</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">parameter_collection</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">)</span>

<span class="c"># Open the output file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c"># Loop over all the molecules</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmolecules</span><span class="p">):</span>

        <span class="c"># Open the file again, because saving closes it</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c"># Get the ith trajectory reference</span>
        <span class="n">trajectory</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;trajectory </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>

        <span class="c"># Get the entire (i.e. [:] at the end) E_{FRET} data vector</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s">&#39;data/E_{FRET}&#39;</span><span class="p">][:]</span>
        <span class="c"># Or equivalently...</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="s">&#39;data/E_{FRET}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="c"># Create a new group for this particular analysis</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;20161231 Laplace Analysis&quot;</span><span class="p">)</span>

        <span class="c"># Add the value of tau to the file for reference</span>
        <span class="n">group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau</span>

        <span class="c"># Add the priors used to the file for reference</span>
        <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">parameter_collection</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="n">priors</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Priors&quot;</span><span class="p">)</span>

        <span class="c"># Do some calculation on data... for instance,</span>
        <span class="n">laplace_result</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">laplace</span><span class="o">.</span><span class="n">laplace_approximation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">priors</span><span class="p">,</span><span class="n">tau</span><span class="p">)</span>

        <span class="c"># Add the results to the file</span>
        <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">laplace_posterior</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="n">laplace_result</span><span class="p">)</span>

        <span class="c"># Save the results as we go in case of a crash</span>
        <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Load, and read from example above</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">biasd</span> <span class="kn">as</span> <span class="nn">b</span>

<span class="c"># Load the SMD</span>
<span class="n">filename</span> <span class="o">=</span><span class="s">&#39;20161230_fret_experiment_1.hdf5&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c"># Read the priors for the first molecule (0)</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;trajectory 0/20161231 Laplace Analysis&#39;</span><span class="p">]</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parameter_collection</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s">&#39;Priors&#39;</span><span class="p">])</span>

<span class="c"># Read the Laplace posterior object for the first molecule (0)</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">laplace_posterior</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">])</span>

<span class="c"># Or if there are also MCMC results called &#39;result&#39; in a group called &#39;20170101 MCMC Analysis&#39; in trajectory 1...</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;trajectory 1/20170101 MCMC Analysis&#39;</span><span class="p">]</span>
<span class="n">mcmc_results</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">smd</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">mcmc</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="code_mcmc.html" class="btn btn-neutral" title="MCMC"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2017, Colin Kinz-Thompson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>